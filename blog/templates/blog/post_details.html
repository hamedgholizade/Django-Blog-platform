{% extends 'base.html' %}
{% load static %}
{% block title %}
    {{ post.title }} - Blog Post
{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'blog/style_post_details.css' %}">
{% endblock %}
{% block content %}

<div class="post-details-card">
    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="post-header">
        <h1>{{ post.title }}</h1>
        <div class="post-meta">
            <span>By <strong>{{ post.author }}</strong></span>
            <span class="dot">‚Ä¢</span>
            <span>{{ post.published_date|date:"F j, Y" }}</span>
        </div>
    </div>
    <div class="tags-container" style="display:flex; gap:10px; flex-wrap:wrap;">
        {% for tag in tag_names %}
            <a href="{% url 'tag:tag_view' tag.slug %}">{{ tag.name }}</a>
        {% endfor %}
    </div>
    <div class="post-image-container">
        {% if post.image %}
            <img src="{{ post.image.url }}" alt="{{ post.title }}">
        {% else %}
            <img src="{% static 'img/default.jpg' %}" alt="Default image">
        {% endif %}
    </div>

    <div class="post-content">
        <p>{{ post.content }}</p>
    </div>

    <div class="post-stats">
        <form method="post" action="{% url 'post_like' post.slug %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="like-button {% if request.user in post.likes.all %}liked{% endif %}">
                {% if request.user in post.likes.all %}
                    ‚ù§Ô∏è {{ post.like_count }} Likes
                {% else %}
                    ü§ç {{ post.like_count }} Likes
                {% endif %}
            </button>
        </form>
        <span>üëÅÔ∏è {{ post.visit_count }} Views</span>
    </div>
    <div class="comments-section">
        <h3>Comments</h3>
        <div class="comments-list">
            {% if comments %}
                {% for comment in comments %}
                <div class="card" style="background:rgba(236,245,255,0.7); margin-bottom:18px; animation:fadeIn 0.7s;">
                    <div style="display:flex; align-items:center; gap:12px;">
                        <img src="{% static 'img/profile_defualt.jpg' %}" style="width:36px; height:36px; border-radius:50%; object-fit:cover;">
                        <div>
                            <span style="font-weight:700; color:var(--primary-dark);">@{{ comment.user.username }}</span>
                            <span style="color:#888; font-size:0.95em;">{{ comment.created_at|date:"F j, Y" }}</span>
                        </div>
                    </div>
                    <div style="margin-top:10px; color:#333;">{{ comment.text }}</div>
                </div>
                {% endfor %}
            {% else %}
                <p class="no-comments">No comments yet. Be the first!</p>
            {% endif %}
        </div>

        <h3>Leave a Comment</h3>
        <form method="post" class="comment-form">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Post Comment</button>
        </form>
    </div>
</div>
{% endblock %}
