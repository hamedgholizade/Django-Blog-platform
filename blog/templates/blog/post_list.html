{% extends "base.html" %}
{% load static %}

{% block title %}Blog Page{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'blog/style_post_list.css' %}">
{% endblock %}
{% block content %}   
    <div style="display: flex; gap: 10px;">

        {% if request.user.user_role == 'W' or request.user.user_role == 'A' %}
        <a href="{% url 'create_post' %}">
          <button class="create-post-button" type="submit">Create a New Post</button>
        </a>
        <a href="{% url 'pending_comments' %}">
          <button class="create-post-button" type="submit">Pending Comments</button>
        </a>
        <a href="{% url 'pending_posts' %}">
          <button class="create-post-button" type="submit">Pending Posts</button>
        </a>
        {% endif %}

      </div>
    <h2>

    {% if search_query %}
        Results for "{{ search_query }}"
    {% elif tag_name %}
        All Posts of "{{ tag_name }}" tag
    {% else %}
        All Posts
    {% endif %}
    
</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 36px;">
    {% for post in page_obj %}
    <div class="card" style="padding:0; overflow:hidden;">
        <a href="{% url 'post_details' post.slug %}">
            {% if post.image %}
                <img src="{{post.image.url}}" style="width:100%; height:180px; object-fit:cover; transition:transform 0.3s;">
            {% else %}
                <img src="{% static 'img/default.jpg' %}" style="width:100%; height:180px; object-fit:cover;">
            {% endif %}
        </a>
        <div style="padding: 20px 22px;">
            <h3 style="margin:0 0 8px 0;">{{ post.title }}</h3>
            <div style="display:flex; align-items:center; gap:10px; color:#888; font-size:0.98em;">
                <img src="{% static 'img/profile_defualt.jpg' %}" style="width:28px; height:28px; border-radius:50%; object-fit:cover;">
                <span>By {{ post.author }}</span>
            </div>
            <p style="margin: 14px 0 0 0; color:#444;">{{ post.content|truncatewords:30 }}</p>
            <a href="{% url 'post_details' post.slug %}" class="btn" style="margin-top: 18px; display:inline-block;">Show More</a>
        </div>
    </div>
    {% endfor %}
</div>
<div class="pagination" style="margin-top: 40px; text-align: center;">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="btn">Previous</a>
    {% endif %}
    <span style="margin: 0 16px;">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="btn">Next</a>
    {% endif %}
</div>
{% endblock %}
